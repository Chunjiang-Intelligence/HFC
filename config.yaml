# ----------------------------- #
#  HFC Trainer - Production    #
#  Configuration               #
# ----------------------------- #

# --- Orchestrator Configuration ---
orchestrator:
  host: "0.0.0.0"
  port: 29500
  min_nodes_to_start: 2
  nodes_per_group: 2
  heartbeat_interval: 30
  grouping_strategy: "spectral"

# --- Node Configuration ---
node:
  # 分佈式訓練基礎配置
  master_addr_env: "MASTER_ADDR"  # 獲取主節點地址的環境變量
  master_port_env: "MASTER_PORT"  # 獲取主節點端口的環境變量

  # 模型和數據集
  model_name_or_path: "meta-llama/Llama-2-7b-hf"
  dataset_name: "c4"
  dataset_config_name: "en" # 使用 c4 的 'en' 子集
  max_seq_len: 1024
  streaming_dataset: true
  dataset_buffer_size: 10000

  # 訓練超參數
  num_train_epochs: 1
  per_device_train_batch_size: 1
  gradient_accumulation_steps: 8
  learning_rate: 1e-4
  weight_decay: 0.1
  lr_scheduler_type: "cosine"
  warmup_ratio: 0.03
  max_train_steps: 100000
  gradient_clipping: 1.0

  # FSDP 配置
  fsdp_strategy: "FULL_SHARD" # FULL_SHARD, SHARD_GRAD_OP, NO_SHARD
  fsdp_offload_params: false
  fsdp_auto_wrap_policy: "size_based"
  fsdp_min_num_params: 1_000_000 # 對於 size_based 策略
  use_bf16: true

  # GaLore 配置
  use_galore: true
  galore_rank: 1024
  galore_update_proj_gap: 200
  galore_scale_factor: 0.25
  use_8bit_adam: true

  # HFC 梯度壓縮 (用於組間通信)
  use_compression: true
  compress_top_k_ratio: 0.01
  compress_quant_bits: 8

  # 異步 DAG 調度器
  use_dag_scheduler: true

  # 保存和日誌
  output_dir: "./hfc_output"
  logging_steps: 10
  save_steps: 1000
  seed: 42

# --- 全局配置 ---
log_level: "INFO"
wandb_project: "hfc-production-training"
